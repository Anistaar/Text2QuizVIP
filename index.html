<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Text2Quiz (Vite)</title>

    <style>
      :root{
        --bg:#0b0f14; --fg:#e8eaed; --muted:#9aa4af; --brd:#22303c;
        --ok-bg:#123d28; --ok-brd:#1f6b45; --ok-fg:#adf0c0;
        --ko-bg:#3a1517; --ko-brd:#5a2225; --ko-fg:#f9b3b6;
        --warn-bg:#2a2417; --warn-brd:#4b4130;
        --primary:#e8eaed; --accent:#84cc16;
      }
      html[data-theme="light"]{
        --bg:#ffffff; --fg:#111; --muted:#6b7280; --brd:#e5e7eb;
        --ok-bg:#eafaf0; --ok-brd:#b4e4c7; --ok-fg:#14532d;
        --ko-bg:#fef2f2; --ko-brd:#f5c2c7; --ko-fg:#7f1d1d;
        --warn-bg:#fff8f0; --warn-brd:#f3d5b0;
        --primary:#111; --accent:#2563eb;
      }

      *{box-sizing:border-box}
      html,body{height:100%}
      body{margin:0;background:var(--bg);color:var(--fg);
        font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

      .wrap{max-width:820px;margin:0 auto;padding:0 12px 24px}

      /* topbar */
      .topbar{position:sticky; top:0; z-index:50; background:var(--bg);
        border-bottom:1px solid var(--brd); display:flex; gap:12px;
        align-items:center; justify-content:space-between; padding:10px 0}
      h1{margin:0; font-size:20px}
      .subtitle{margin:6px 0 12px; color:var(--muted); font-size:14px}
      .theme-toggle{display:flex; align-items:center; gap:8px; font-weight:600}
      .theme-toggle input{transform:scale(1.1)}

      /* panneau options */
      .card{border:1px solid var(--brd); border-radius:12px; background:transparent;
        padding:12px; margin:10px 0}

      /* Explorer compact styles */
      .fb-folder{padding:6px 8px; border-radius:6px; margin-bottom:4px}
      .fb-folder.active{background:rgba(255,255,255,0.03)}
      .fb-file{display:flex; align-items:center; justify-content:space-between; padding:8px 10px; border-radius:8px}
      .fb-file .label{flex:1}
      .fb-file .controls{display:flex; gap:8px; align-items:center}
      .fb-toolbar{display:flex; gap:8px; align-items:center; margin-bottom:6px}
      .fb-toolbar select, .fb-file select{padding:6px 8px; border-radius:6px}
      .row{display:grid; gap:6px; margin-bottom:10px}
      label{font-weight:600; font-size:14px}
      select,input{padding:8px 10px; border-radius:10px; border:1px solid var(--brd);
        background:transparent; color:var(--fg); font-size:14px}
      select option{background:var(--bg); color:var(--fg)}
      .modes{display:flex; gap:14px}

      /* boutons */
      .primary,.secondary{padding:8px 12px; border-radius:10px; cursor:pointer; font-size:14px}
      .primary{border:1px solid var(--primary); background:transparent; color:var(--primary)}
      .primary:hover{background:var(--primary); color:var(--bg)}
      .secondary{border:1px solid var(--primary); background:transparent; color:var(--primary)}
      .primary:disabled{opacity:.6; cursor:not-allowed}

      /* checkboxes pour cours multiples */
      .cours-checkbox-item {
        display: flex; align-items: center; gap: 8px; padding: 4px 6px; 
        border-radius: 6px; margin-bottom: 2px;
      }
      .cours-checkbox-item:hover {
        background: rgba(255,255,255,0.05);
      }
      .cours-checkbox-item input[type="checkbox"] {
        transform: scale(1.1);
      }
      .cours-checkbox-item .folder-tag {
        font-size: 11px; color: var(--muted); 
        background: rgba(255,255,255,0.1); padding: 1px 4px; 
        border-radius: 3px; margin-left: auto;
      }

      /* ent√™te quiz + barre */
      .head{display:flex; gap:10px; justify-content:space-between; flex-wrap:wrap; margin:8px 0}
      .badge{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid var(--brd);
        font-size:12px; color:var(--muted)}
      .progress{height:8px; background:transparent; border-radius:999px; border:1px solid var(--brd); overflow:hidden}
      .progress__bar{height:100%; background:var(--accent); transition:width .2s ease}

      /* carte question compacte */
      .card--q{position:relative; border:1px solid var(--brd); border-radius:12px; background:transparent;
        padding:12px; margin:10px 0; max-height:62vh; overflow:auto; scroll-behavior:smooth}
      .qtitle{font-weight:800; margin:0 0 6px 0}
      .block{margin:8px 0}
      .hint{margin-top:4px}
      small.muted{color:var(--muted)}

      /* options grille */
      .options{display:grid; gap:8px; margin:10px 0}
      @media (min-width:768px){ .options{grid-template-columns:repeat(2,minmax(0,1fr))} }
      .options--inline{grid-template-columns:none; grid-auto-flow:column; justify-content:start}

      .opt{display:flex; gap:8px; align-items:center; padding:8px 10px;
        border:1px solid var(--brd); border-radius:10px; transition:.15s}
      .opt input{transform:scale(1.05); margin-top:1px}
      .opt.good{background:var(--ok-bg); border-color:var(--ok-brd)}
      .opt.bad{background:var(--ko-bg); border-color:var(--ko-brd)}
      .opt .label{flex:1}
      .mark{margin-left:auto; font-weight:800}
      .mark--good{color:var(--ok-fg)}
      .mark--bad{color:var(--ko-fg)}

      /* feedback repliable */
      .feedback{margin-top:8px; border-radius:10px; padding:8px}
      .feedback.ok{background:var(--ok-bg); border:1px solid var(--ok-brd)}
      .feedback.ko{background:var(--ko-bg); border:1px solid var(--ko-brd)}
      details.feedback > summary{cursor:pointer; list-style:none; font-weight:700}
      details.feedback > summary::-webkit-details-marker{display:none}

      /* bouton suivant flottant */
      .fab-next{position:fixed; right:18px; bottom:18px; z-index:60; border-radius:999px;
        padding:10px 14px; font-weight:700; border:1px solid var(--primary); background:var(--primary);
        color:var(--bg); box-shadow:0 6px 30px rgba(0,0,0,.25); cursor:pointer}
      .fab-next:disabled{opacity:.6; cursor:not-allowed}

      /* r√©sultats */
      .list{display:grid; gap:8px; padding-left:18px}
      .list li{list-style:decimal; border:1px solid var(--brd); border-radius:12px; padding:10px}
      .list li.ok{background:var(--ok-bg); border-color:var(--ok-brd)}
      .list li.ko{background:var(--warn-bg); border-color:var(--warn-brd)}

      /* drag and drop */
      .drag-container{margin-top:16px}
      .drag-items{display:grid; gap:12px; margin-bottom:16px}
      .drag-item-row{display:grid; grid-template-columns:1fr 2fr auto; gap:12px; align-items:center}
      .drag-item-row.correct{background:var(--ok-bg); border-radius:8px; padding:8px}
      .drag-item-row.incorrect{background:var(--ko-bg); border-radius:8px; padding:8px}
      .drag-item-label{font-weight:600; padding:8px}
      .drag-drop-zone{min-height:40px; border:2px dashed var(--brd); border-radius:8px; padding:4px;
        display:flex; align-items:center; justify-content:center; transition:all 0.2s}
      .drag-drop-zone.drag-over{border-color:var(--accent); background:rgba(132,204,22,0.1)}
      .drag-drop-zone .placeholder{color:var(--muted); font-size:13px}
      .drag-match-chip{display:inline-block; padding:6px 12px; background:var(--accent); color:var(--bg);
        border-radius:6px; cursor:grab; user-select:none; font-size:14px}
      .drag-match-chip:active{cursor:grabbing}
      .drag-match-chip.dragging{opacity:0.5}
      .drag-match-chip.used{opacity:0.4}
      .drag-matches-pool{margin-top:16px; padding:12px; border:1px solid var(--brd); border-radius:8px}
      .pool-label{font-weight:600; margin-bottom:8px; font-size:14px}
      .drag-matches{display:flex; flex-wrap:wrap; gap:8px}
      .correct-answer{color:var(--ok-fg); font-weight:600; font-size:13px}
    </style>
  </head>

  <body>
    <div class="wrap">
      <header class="topbar">
        <h1>Text2Quiz (Vite + TS)</h1>
        <div style="display:flex; gap:12px; align-items:center">
          <button id="btn-explorer" class="secondary">Explorer les fichiers</button>
          <label class="theme-toggle" title="Basculer clair/sombre">
          <input id="theme-toggle" type="checkbox" />
          <span>üåô</span>
          </label>
        </div>
      </header>

      <p class="subtitle">
        Entra√Ænement (correction imm√©diate + explication) ou Examen (correction √† la fin).
      </p>

      <div class="card">
        <div class="row">
          <label for="matiere">Mati√®re</label>
          <select id="matiere"></select>
        </div>

        <div class="row">
          <label>
            <input type="checkbox" id="multi-cours-toggle" /> 
            R√©vision multi-cours
          </label>
        </div>

        <div class="row">
          <label for="cours">Cours</label>
          <select id="cours"></select>
          <div id="cours-multi-checkboxes" style="display:none; max-height: 200px; overflow-y: auto; border: 1px solid var(--brd); border-radius: 8px; padding: 8px;">
            <div style="margin-bottom: 8px; font-size: 12px; color: var(--muted);">
              <label><input type="checkbox" id="select-all-cours" /> Tout s√©lectionner</label>
            </div>
            <div id="cours-checkbox-list"></div>
          </div>
        </div>

        <div class="row">
          <label for="themes">Th√®mes (optionnel)</label>
          <select id="themes" multiple size="5" title="Ctrl/Cmd-clic pour multi-s√©lection"></select>
        </div>

        <div class="row">
          <label for="nombre">Nombre de questions</label>
          <input id="nombre" type="number" min="1" step="1" value="10"/>
        </div>

        <div class="row">
          <label>Mode</label>
          <div class="modes">
            <label><input type="radio" name="mode" value="entrainement" checked> Entra√Ænement</label>
            <label><input type="radio" name="mode" value="examen"> Examen</label>
          </div>
        </div>

        <div class="row">
          <label>Types de questions (optionnel)</label>
          <div style="display:flex; gap:8px; flex-wrap:wrap">
            <label><input type="checkbox" class="qtype" value="QCM" checked/> QCM</label>
            <label><input type="checkbox" class="qtype" value="QR" checked/> QR</label>
            <label><input type="checkbox" class="qtype" value="VF" checked/> VF</label>
            <label><input type="checkbox" class="qtype" value="DragMatch" checked/> DragMatch</label>
          </div>
        </div>

        <button id="start" class="primary">Commencer</button>
      </div>

      <div id="quiz-root"></div>
    
    <!-- File browser modal (Windows-like explorer) -->
    <div id="file-browser" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:80;">
      <div style="max-width:1000px; height:70vh; margin:40px auto; background:var(--bg); padding:8px; border-radius:8px; border:1px solid var(--brd); display:flex;">
        <div style="width:260px; border-right:1px solid var(--brd); padding:8px; overflow:auto">
          <h4 style="margin:6px 0">Mati√®res</h4>
          <div id="fb-folders"></div>
        </div>
        <div style="flex:1; padding:8px; overflow:auto; display:flex; flex-direction:column">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <h4 style="margin:6px 0">Cours</h4>
            <div><button id="fb-close" class="secondary">Fermer</button></div>
          </div>
          <div id="fb-files" style="margin-top:8px; display:grid; gap:8px;"></div>
        </div>
      </div>
    </div>

    <!-- QCM full-page viewer -->
    <div id="qcm-view" style="display:none; position:fixed; inset:0; background:var(--bg); z-index:90; padding:20px; overflow:auto">
      <div style="max-width:980px; margin:0 auto;">
        <button id="qcm-close" class="secondary" style="margin-bottom:12px">Retour</button>
        <div id="qcm-root"></div>
      </div>
    </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
